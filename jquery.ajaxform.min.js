/**
 * jQuery Ajax Form
 * https://github.com/garagesocial/ajax-form-js
 *
 * Licensed under the MIT license.
 * Copyright 2013 Garagesocial, Inc.
 */

!function($){if(!$.GS){$.GS={}}$.GS.ajax_form=function(el,options){var base=this;base.$el=$(el);base.el=el;base.$el.data("GS.ajax_form",base);base.init=function(){base.options=$.extend({},$.GS.ajax_form.defaultOptions,options);$.each(base.options,function(key,val){base[key]=val});var required_options=new Array("trigger_el","target_url");$.each(required_options,function(current_option){if(typeof base.options[required_options[current_option]]==="undefined"||base.options[required_options[current_option]]===null){console.log("you have not defined option: "+required_options[current_option]);return}});base.trigger_el=$(base.trigger_el);base.trigger_el.on("click",function(e){e.preventDefault();base.submitForm()})};base.submitForm=function(){var form_data,add_data,data;if(base.before_request_condition&&base.isFunction(base.before_request_condition)){if(!base.before_request_condition()){return}}if(base.isFunction(base.before_request)){base.before_request()}form_data=base.getFormData(base.el);add_data=base.isFunction(base.additional_data)?base.additional_data():base.additional_data;data=$.extend(form_data,add_data);console.log(data);$.ajax({type:"POST",url:base.target_url,data:data,dataType:"json",success:function(data){if(base.isFunction(base.after_request_success)){base.after_request_success(data)}if(base.redirect_url_on_success){var url=base.isFunction(base.redirect_url_on_success)?base.redirect_url_on_success():base.redirect_url_on_success;window.location.replace(url)}else if(data.redirect_url){window.location.replace(data.redirect_url)}},error:function(data){if(base.isFunction(base.after_request_error)){base.after_request_error(data)}if(base.redirect_url_on_error){var url=base.isFunction(base.redirect_url_on_error)?base.redirect_url_on_error():base.redirect_url_on_error;window.location.replace(url)}else if(data.redirect_url){window.location.replace(data.redirect_url)}}})};base.getFormData=function(inputElement){var data={};var serializedData=$(inputElement).serializeArray();$.each(serializedData,function(i,val){data[val.name]=val.value});return data};base.isFunction=function(functionToCheck){var getType={};return functionToCheck&&getType.toString.call(functionToCheck)==="[object Function]"};base.option=function(key,value){if($.isPlainObject(key)){this.options=$.extend(true,this.options,key)}};base.init()};$.GS.ajax_form.defaultOptions={before_request_condition:null,before_request:null,after_request_success:null,after_request_error:null,redirect_url_on_success:null,redirect_url_on_error:null,additional_data:null};$.fn.gs_ajax_form=function(options){return this.each(function(){new $.GS.ajax_form(this,options)})};$.fn.getGS_ajax_form=function(){this.data("GS.ajax_form")}}(jQuery);